(function(d){function m(a){var c=0,b=document.createElement("a");b.href=a;for(var g={},h=b.search.replace(/^\?/,"").split("&"),u=h.length,i=0,d;i<u;i++)h[i]&&(d=h[i].split("="),g[d[0]]=d[1],c++);g.path=b.pathname;g.search=b.search;g.porthost=b.port&&"0"!==b.port&&""!==b.port?b.hostname+":"+b.port:b.hostname;a=a.replace(/\?.*/,"");h=a.lastIndexOf("/");g.localPath=a.slice(0,h+1);g.file=b.pathname.match(/.[^\/]*\.[\w\d\_\.]+/)||"";return c?g:null}var k=d.jquery||d.jQuery||d.Zepto||null,f="_rnd"+(new Date).getTime(),
p;p=!0;try{document.write('<p id="'+f+'"></p>');var q=document.getElementById(f),o=q.parentNode,v=q.previousSibling;o.removeChild(q);var q=null,e=m(v.src)}catch(y){o=k("#sewise-subtitles-js").parent(),e=m(k("#sewise-subtitles-js").attr("src")),p=!1}window.SewiseSubtitles={};window.SewiseSubtitles.queryData=e;if(!e)return!1;f=document.createElement("div");f.className="_player_layout";var j=document.createElement("div");j.className="_subtitles_layout";p?(o.appendChild(f),o.appendChild(j)):(o.append(f),
o.append(j));e.lang=e.sublang?e.sublang:"zh_cn";p=e.search;var r=function(){this.handle=null;this.debug=0;this.data=[];this.TmpDat=[];this.prevTime=-1;this.memTime=0;this.lightDoms=[];this.options={};this.inited=!1;this.plight=null};r.prototype={init:function(a){this.options={stopEvent:null,htmlEndEvent:null,jumpEvent:null,lineEvent:null,data:[],target:null,highlight:"_subtitles_highlight",subtitles:"subtitles",wrap:"div",line:"p",word:"span"};for(var c in this.options)this.options.hasOwnProperty(c)&&
a[c]&&(this.options[c]=a[c]);this.data=this.clone(this.options.data);this.TmpDat=this.clone(this.options.data);this.html();this.inited=!0},clone:function(a){var c=a.constructor===Array?[]:{},b;for(b in a)a.hasOwnProperty(b)&&(c[b]="object"===typeof a[b]?this.clone(a[b]):a[b]);return c},jump:function(a){if(this.inited){var c=a&&parseInt(a)?parseInt(a):0;if(this.prevTime>c)this.TmpDat=this.clone(this.clone(this.data)),this.memTime=0;this.prevTime=c+0;num=0;baseline=-1;var b=0;for(nextTime=0,itemTime=
0,maxTime=0;0<this.TmpDat[1].length;){var g=this.TmpDat[1].length,b=this.TmpDat[1][0][0],a=this.clone(this.TmpDat[1][0][1]);a.sort(function(a,b){return a[0]<b[0]});maxTime=b+a[0][0];if(1<g)if(nextTime=this.TmpDat[1][1][0],c>=nextTime)this.shift(this.TmpDat[1]);else{if(c>maxTime){this.shift(this.TmpDat[1]);break}if(this.memTime==b)break;for(var g=0,h=a.length-1;0<=h;h--)c>=b&&(this.showlight(a[h][1],a[h][2]),g++);if(g)this.memTime=b,a.sort(function(a,b){return b[1]>=a[1]&&b[2]>a[2]}),c=this.dquery(a[0][1],
a[0][2]),this.event("jumpEvent",[c,a[0][1],a[0][2]]);break}else{for(h=a.length-1;0<=h;h--)itemTime=b+a[h][0],c>=b&&itemTime>c&&this.showlight(a[h][1],a[h][2]);a.sort(function(a,b){return b[1]>=a[1]&&b[2]>a[2]});c=this.dquery(a[0][1],a[0][2]);this.event("jumpEvent",[c,a[0][1],a[0][2]]);this.event("stopEvent",[c,a[0][1],a[0][2]]);this.TmpDat[1].splice(0,1);break}}0==this.TmpDat[1].length&&this.closelight()}},shift:function(a){this.memTime=0;this.closelight();a.splice(0,1);return a},html:function(){for(var a=
this.options.target,c=this.options.data,b=this.options.wrap,g=this.options.line,h="rnd"+(new Date).getTime(),d="",i=0;i<c[0].length;i++)d+="<"+g+">"+c[0][i]+"</"+g+">";a.innerHTML="<"+b+' id="'+h+'" class="'+this.options.subtitles+'">'+d+"</"+b+">";this.wrap=document.getElementById(h);this.event("htmlEndEvent")},dquery:function(a,c){if(isNaN(a)||isNaN(c))return null;var b=this.wrap,b=a<b.childNodes.length?b.childNodes[a]:null;return!b?null:(b=c<b.childNodes.length?b.childNodes[c]:null)?b:null},showlight:function(a,
c){var b=this.dquery(a,c),g=b.parentNode,d=g.className;if(b){var e=b.className,i=this.options.highlight,f=RegExp(i);if(!f.test(e))e=e.split(" "),e.push(i),b.className=e.join(" ");if(!f.test(d)){if(this.plight)this.plight.className="",this.event("lineEvent",[g]);e=d.split(" ");e.push(i);g.className=e.join(" ");this.plight=g}this.lightDoms.push(b)}},closelight:function(){for(var a=RegExp(this.options.highlight,"gm"),c=0;c<this.lightDoms.length;c++)this.lightDoms[c].className=this.lightDoms[c].className.replace(a,
"");this.lightDoms.length=0},event:function(a,c){try{var b=this.options[a]||null;b&&"function"==typeof b&&(c?b.apply(b,c):b.apply(b,[]))}catch(d){}}};var w=function(a,c,b){if("true"===e.debug)e.porthost="192.168.1.24",a=e.recordid;c="http://"+e.porthost+"/service/playerapi/?do=getsubtitle";window.SewiseSubtitlesData?b(window.SewiseSubtitlesData.words,window.SewiseSubtitlesData):k.ajax({url:c,type:"GET",dataType:"jsonp",jsonp:"jsproxy",data:{"do":"getsubtitle",sourceid:a},success:function(a){a.errors||
"Array"==("[object Array]"===Object.prototype.toString.apply(a.words)?"Array":typeof a.words)&&b&&"function"==typeof b&&b(a.words,a)},error:function(){}})},x=function(a){for(var c=0,b=[],d=[],e=[],f="",i={},j="",k=0,m=0,l=0;l<a.length;l++){for(var f="",n=0;n<a[l].length;n++)c=parseInt((1E3*parseFloat(a[l][n].st)).toFixed(0)),etime=parseInt((1E3*parseFloat(a[l][n].et)).toFixed(0)),m=etime-c,j=c.toString(),0<m?(e.push([c,l,n,m]),f+='<span time="'+c+'">'+a[l][n].token+" </span>",i[j]||(i[j]=[]),i[j].push([m,
l,n])):f+="<span>"+a[l][n].token+" </span>",k++;d.push(f)}e=[];for(l in i)i.hasOwnProperty(l)&&e.push([parseInt(l),i[l]]);b[0]=d;b[1]=e;return b},s=d.oSubtitlesShow=function(){var a=new r,c=!1;d._engine_of_TSubtitlesShowed=a;return{init:function(b){c||(a.init(b),c=!0)},run:function(b){a.jump(b)}}}(),t=function(){w(e.sourceid,e.lang,function(a){a=x(a);s.init({target:j,data:a,htmlEndEvent:function(){if(e.click&&"false"==e.click)return!1;k(j).find("span").click(function(){var a=k(this).attr("time");
SewisePlayer&&SewisePlayer.doSeek&&a&&SewisePlayer.doSeek(a/1E3)})},jumpEvent:function(){},lineEvent:function(a){if(e.runline&&"false"==e.runline)return!1;if(j.scrollHeight>j.clientHeight)a=a.offsetTop-j.clientHeight/2-j.offsetTop,j.scrollTop=0<a?j.scrollTopMax<a?j.scrollTopMax:a:1}})})};d.onPlayTime=function(a){a=a?parseFloat(a):0;s.run(1E3*a)};sws_loadPlayer(f,p,function(){if(k)t();else{var a=document.createElement("script");a.src=e.localPath+"js/jquery.min.js";document.getElementsByTagName("head")[0].appendChild(a);
a.onload=a.onreadystatechange=function(){if(!a.readyState||"loaded"==a.readyState||"complete"==a.readyState)k=d.jQuery,t()}}})})(window||this);
(function(d){if(d.document)d=document.createElement("style"),d.className="Subtitles_Style_U_Can_Custom",d.setAttribute("type","text/css"),d.textContent?d.textContent="span._subtitles_highlight{ background-color: #000; color: #4f1; } p._subtitles_highlight{ background-color: #E8E8E8; color: inherit; } ._player_layout{ height: 100%; width: 60%; float: left; } ._subtitles_layout{ float: right; height: 100%; width: 36%; overflow: auto; } ":d.styleSheet?d.styleSheet.cssText="span._subtitles_highlight{ background-color: #000; color: #4f1; } p._subtitles_highlight{ background-color: #E8E8E8; color: inherit; } ._player_layout{ height: 100%; width: 60%; float: left; } ._subtitles_layout{ float: right; height: 100%; width: 36%; overflow: auto; } ":
d.innerHTML="span._subtitles_highlight{ background-color: #000; color: #4f1; } p._subtitles_highlight{ background-color: #E8E8E8; color: inherit; } ._player_layout{ height: 100%; width: 60%; float: left; } ._subtitles_layout{ float: right; height: 100%; width: 36%; overflow: auto; } ",document.getElementsByTagName("head")[0].appendChild(d)})(window||this);
function sws_loadPlayer(d,m,k){var m=window.SewiseSubtitles.queryData.localPath+"player/sewise.player.min.js"+m,f=document.createElement("script");f.src=m;f.onload=f.onreadystatechange=function(){(!f.readyState||"loaded"==f.readyState||"complete"==f.readyState)&&k&&"function"==typeof k&&k()};d.appendChild(f)};
